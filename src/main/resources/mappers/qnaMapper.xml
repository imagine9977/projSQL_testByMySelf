<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC 
"-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Qna">

	<!-- 총 질문 빛 답변 수 -->
	<select id="getTotalCount" resultType="int">
		select COUNT(*) from qna
	</select>

	<!-- has a 관계 설정 -->
	<resultMap type="com.proj03.dto.Qna" id="qnaRM">
		<result property="member.id" column="qaid"/>
		<result property="member.name" column="qname"/>
	</resultMap>
	 

	
	<!-- 묻고 답하기 목록 조회 -->
	<select id="getQnaList"  resultMap="qnaRM">
		select q.qno, q.cate, q.qtitle, q.qcontent, q.qlevel, q.qparno, q.qhits, q.qresdate, m.id, m.name 
		from qna q, member m 
		where q.qaid=m.id  order by q.qresdate desc  
	</select>	
	<!-- 묻고 답하기 목록 조회 -->
	<select id="getCatQnaList" resultMap="qnaRM">
		select q.qno, q.cate, q.qtitle, q.qcontent, q.qlevel, q.qparno, q.qhits, q.qresdate, m.id, m.name 
		from qna q, member m 
		where (q.qaid=m.id and q.cate=#{cat} )order by q.qresdate desc  
	</select>	

	<!-- 묻고 답하기 상세 보기 -->
	<select id="getQna" resultMap="qnaRM">
		select q.qno,  q.qtitle, q.qlevel, q.qcontent, q.qparno, q.qhits, q.qresdate, m.id, m.name, q.secret,  q.cate
		from qna q, member m 
		where q.qaid=m.id and qno=#{no}
	</select>
	
	<!-- 질문 글 등록 -->
	<insert id="insQuestion" parameterType="com.proj03.dto.Qna">
		insert into qna values (default, #{title},  #{content},default, default, 
		default, default, #{member.id}, #{member.name}, #{secret}, #{cate})
	</insert>

	<!-- 질문 글에 대한 부모 글번호 변경 -->
	<update id="upParno">
		update qna set qparno=#{no} where qno=#{no}
	</update>

	<!-- 답변 글 등록 -->
	<insert id="insAnswer" parameterType="com.proj03.dto.Qna">
		insert into qna values (default, #{title}, #{content}, #{lev}, #{parno}, 
		default, default, #{member.id}, #{member.name}, #{secret}, #{cate})
	</insert>
	
	<!-- 묻고 답하기 글 변경 -->
	<update id="upQna" parameterType="com.proj03.dto.Qna">
		update qna set qtitle=#{title}, qcontent=#{content}, secret=#{secret} where qno=#{no}
	</update>

	<!-- 묻고 답하기 글 조회수 증가 -->
	<update id="hitCount">
		update qna set qhits=qhits+1 where qno=#{no}
	</update>
	
	<!-- 묻고 답하기 글 삭제 -->
	<delete id="delQna">
		delete from qna where qno=#{no}
	</delete>
</mapper>